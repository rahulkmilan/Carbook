{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Carbook</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/open-iconic-bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">
    
    <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">

    <link rel="stylesheet" href="{% static 'css/aos.css' %}">

    <link rel="stylesheet" href="{% static 'css/ionicons.min.css' %}">

    <link rel="stylesheet" href="{% static 'css/bootstrap-datepicker.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery.timepicker.css' %}">

    
    <link rel="stylesheet" href="{% static 'css/flaticon.css' %}">
    <link rel="stylesheet" href="{% static 'css/icomoon.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    
    


    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}">

	<style>
		#lout {
			background-color: transparent;
			color: white;
			padding: 5px 5px;
			margin: 3px;
			border-radius: 5px;
			border: 0;
		}
		#lout:hover {
			color: gray;
		}
    .card-body {
        padding-bottom: 20px; 
    }

    .card-footer {
        padding-top: 20px; /* Adjust as needed */
    }
    
    .card {
        border: 1px solid #dee2e6;
        border-radius: 10px;
        overflow: hidden;
        transition: transform 0.3s ease;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0px 0px 15px 0px rgba(0,0,0,0.1);
    }

    .card-img-top {
        width: 100%;
        height: auto;
        border-bottom: 1px solid #dee2e6;
    }

    .card-body {
        padding: 20px;
    }

    .card-title {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .card-text {
        font-size: 16px;
        margin-bottom: 5px;
    }

    .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
    }

    .btn-primary:hover {
        background-color: #0056b3;
        border-color: #0056b3;
    }

    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }

    .btn-secondary:hover {
        background-color: #5a6268;
        border-color: #545b62;
    }
body {
  
    padding-top: 60px; /* Height of the fixed navbar */
    margin: 0;
}
a{
  text-decoration: none;
}

	</style>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </head>
  <body>
    <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Confirmation</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              <div class="modal-body">
                  Are you sure you want to book this car?
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-primary" id="confirmBooking">Yes, Book it</button>
                  <button type="button" class="btn" data-dismiss="modal" style="background-color: gray; color:white;">Cancel</button>
              </div>
          </div>
      </div>
  </div>
	  <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-dark fixed-top"  id="ftco-navbar">
	    <div class="container">
	      <a class="navbar-brand" href="customer-log">Car<span>Book</span></a>
	      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
	        <span class="oi oi-menu"></span> Menu
	      </button>

	      <div class="collapse navbar-collapse" id="ftco-nav">
	        <ul class="navbar-nav ml-auto">
	          <li class="nav-item"><a href="#" class="nav-link">Home</a></li>
	          <li class="nav-item"><a href="#bookings" class="nav-link">Bookings</a></li>
	          <!-- <li class="nav-item"><a href="" class="nav-link">Profile</a></li> -->
			  <form method="post" action="logout">
				{% csrf_token %}
				<!-- <input id="lout"  type="submit" value="Logout"> -->
        <button type="button" id="lout">Logout</button>
				</form>        
	        </ul>
	      </div>
	    </div>
	  </nav>
    <!-- END nav -->

    <section class="ftco-section ftco-no-pt bg-light">
      <div class="container">
          <div class="row justify-content-center">
            <h2 style="margin-top: 15px;" class="text-capitalize">Welcome, {{ username }}</h2><br>
            {% for message in messages %}
              <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% endif %} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
              {% endfor %}
              <div class="col-md-12 heading-section text-center ftco-animate mb-5">
                <div class="row align-items-center">
                    <div class="col-md-10 mb-3 mb-md-0">
                        <h2 class="mb-2" style="margin-left: 200px;">Available Vehicles</h2>
                    </div>
                    <div class="col-md-2">
                        <form method="GET" action="{% url 'profile' %}">
                            <div class="row align-items-end">
                                <div class="col-md-9">
                                    <label for="location" class="form-label">Filter by Location:</label>
                                    <select id="location" name="location" class="form-select">
                                        <option value="">All Locations</option>
                                        <!-- Add options dynamically based on available locations -->
                                        {% for location in locations %}
                                            <option value="{{ location }}">{{ location }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <button type="submit" class="btn btn-primary mt-2">Apply</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            
          </div>
          
          <div class="row">
                {% if cars %}
                    {% for car in cars %}
                        {% if not car.booked and car.availability %}
                            <div class="col-md-4">
                                <div class="card mb-4">
                                    <img src="{{ car.photos.url }}" class="card-img-top" alt="{{ car.make }} {{ car.model }}" style="height: 250px; width:auto;">
                                    <div class="card-body">
                                        <h5 class="card-title">{{ car.make }} {{ car.model }}</h5>
                                        <p class="card-text">Year: {{ car.year }}</p>
                                        <p class="card-text">Location: {{ car.location }}</p>
                                        <p class="card-text">Price: Rs.{{ car.price }} /day</p>
                                        <p class="card-text">Dealer: {{ car.username }}</p>
                                        <p class="d-flex mb-0 d-block"><a href="{% url 'book' car.regno %}" class="btn btn-primary">Book now</a></p>
                                    </div>
                                </div>
                            </div>
                            
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <p>No cars available.</p>
                {% endif %}
        </div>
        
      </div>
  </section>
  <!--logout model  -->
  <div class="modal fade" id="logoutConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Logout Confirmation</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Are you sure you want to logout?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="confirmLogout">Logout</button>
          <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

<section id="bookings" class="ftco-section ftco-no-pt bg-dark">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 heading-section text-center ftco-animate mb-5">
                <h2 class="mb-2" style="color: white; padding: 15px;">Your Bookings</h2>
            </div>
        </div>
        {% if bookings %}
        <div class="row">
            {% for booking in bookings %}
            <div class="col-md-4">
                <div class="card mb-4">
                    <img src="{{ booking.car.photos.url }}" class="card-img-top"
                        alt="{{ booking.car.make }} {{ booking.car.model }}" style="height: 250px; width:auto;">
                    <div class="card-body">
                        <h5 class="card-title">{{ booking.car.make }} {{ booking.car.model }}</h5>
                        <p class="card-text">Regno: {{ booking.regno }}</p>
                        <p class="card-text">Contact no: {{ booking.dealer.pno }}</p>
                        <p class="card-text">Drop-off Location: {{ booking.dropoff_location }}</p>
                        <p class="card-text">Drop-off Date: {{ booking.dropoff_date }}</p>
                        <p class="card-text">Drop-off Time: {{ booking.dropoff_time }}</p>
                        <p class="card-text">No. of Days: {{ booking.nod }}</p>
                        {% if booking.cancel %}
                        <!-- Cancel Button with Confirmation Modal -->
                        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#confirmationModal{{ booking.id }}">Cancel Booking</button>
                        {% endif %}
                      </div>
                </div>
            </div>
            <!-- Confirmation Modal for Each Booking -->
            <div class="modal fade" id="confirmationModal{{ booking.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Confirm Cancellation</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to cancel this booking?
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-primary" onclick="cancelBooking('{{ booking.id }}')">Confirm</button>
                            <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
                            
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p style="color: white;" >You have no bookings.</p>
    </div>
    {% endif %}
</section>




	
	

    <footer class="ftco-footer ftco-bg-dark ftco-section">
      <div class="container">
        <div class="row mb-5">
          <div class="col-md">
            <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2"><a href="#" class="logo">Car<span>book</span></a></h2>
              <p>Discover the fastest and easiest way to rent a car with Carbook. From road trips to city explorations, we offer a seamless booking process and a diverse range of vehicles to suit your needs.</p>
              <ul class="ftco-footer-social list-unstyled float-md-left float-lft mt-5">
                <li class="ftco-animate"><a href="#"><span class="icon-twitter"></span></a></li>
                <li class="ftco-animate"><a href="#"><span class="icon-facebook"></span></a></li>
                <li class="ftco-animate"><a href="#"><span class="icon-instagram"></span></a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
            <div class="ftco-footer-widget mb-4 ml-md-5">
              <h2 class="ftco-heading-2">Information</h2>
              <ul class="list-unstyled">
                <li><a href="#" class="py-2 d-block">About</a></li>
                <li><a href="#" class="py-2 d-block">Services</a></li>
                <li><a href="#" class="py-2 d-block">Term and Conditions</a></li>
                <li><a href="#" class="py-2 d-block">Best Price Guarantee</a></li>
                <li><a href="#" class="py-2 d-block">Privacy &amp; Cookies Policy</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
             <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2">Customer Support</h2>
              <ul class="list-unstyled">
                <li><a href="#" class="py-2 d-block">FAQ</a></li>
                <li><a href="#" class="py-2 d-block">Payment Option</a></li>
                <li><a href="#" class="py-2 d-block">Booking Tips</a></li>
                <li><a href="#" class="py-2 d-block">How it works</a></li>
                <li><a href="#" class="py-2 d-block">Contact Us</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
            <div class="ftco-footer-widget mb-4">
            	<h2 class="ftco-heading-2">Have a Questions?</h2>
            	<div class="block-23 mb-3">
	              <ul>
	                <li><span class="icon icon-map-marker"></span><span class="text">203 Fake St. Mountain View, San Francisco, California, USA</span></li>
	                <li><a href="#"><span class="icon icon-phone"></span><span class="text">+2 392 3929 210</span></a></li>
	                <li><a href="mailto:carbook.demo@gmail.com"><span class="icon icon-envelope"></span><span class="text">carbook.demo@gmail.com</span></a></li>
	              </ul>
	            </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 text-center">

            <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved 
  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
          </div>
        </div>
      </div>
    </footer>

  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


  <script src="{% static 'js/jquery.min.js' %}"></script>
  <script src="{% static 'js/jquery-migrate-3.0.1.min.js' %}"></script>
  <script src="{% static 'js/popper.min.js' %}"></script>
  <script src="{% static 'js/bootstrap.min.js' %}"></script>
  <script src="{% static 'js/jquery.easing.1.3.js' %}"></script>
  <script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
  <script src="{% static 'js/jquery.stellar.min.js' %}"></script>
  <script src="{% static 'js/owl.carousel.min.js' %}"></script>
  <script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
  <script src="{% static 'js/aos.js' %}"></script>
  <script src="{% static 'js/jquery.animateNumber.min.js' %}"></script>
  <script src="{% static 'js/bootstrap-datepicker.js' %}"></script>
  <script src="{% static 'js/jquery.timepicker.min.js' %}"></script>
  <script src="{% static 'js/scrollax.min.js' %}"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="{% static 'js/google-map.js' %}"></script>
  <script src="{% static 'js/main.js' %}"></script>
  

  <script>
    function openConfirmationModal(bookingId) {
        $('#confirmationModal' + bookingId).modal('show');
    }

    function cancelBooking(bookingId) {
        // Close the modal
        $('#confirmationModal' + bookingId).modal('hide');

        // Perform cancellation action here, such as making an AJAX request to cancel the booking
        // For demonstration purposes, I'm just redirecting to the cancel booking URL with the booking ID
        window.location.href = "/cancel-booking/" + bookingId + "/";
    }
    
      $(document).ready(function() {
        $('#lout').click(function() {
          $('#logoutConfirmationModal').modal('show');
        });
    
        $('#confirmLogout').click(function() {
          // Submit the form when logout is confirmed
          $('#lout').closest('form').submit();
        });
      });
    
</script>
    
</body>
</html>